import{g as h,a as n}from"./utils-DJxqsy3g.js";import{E as p}from"./ExternalServices-BOC11meF.js";const y=.06;function x(r){return r.map(e=>({id:e.Id,name:e.Name,price:e.FinalPrice,quantity:e.quantity||1}))}function f(r){if(!/^(0[1-9]|1[0-2])\/\d{2}$/.test(r))return n("Invalid expiration format. Use MM/YY (e.g., 12/26)."),!0;const[s,t]=r.split("/"),i=Number(s),o=Number(t),a=new Date(2e3+o,i);return new Date>=a?(n("Invalid expiration date. Please enter a valid expiration date."),!0):!1}class g{constructor(e){this.key=e,this.list=h(e)||[],this.services=new p}init(){this.displayOrderSummary()}displayOrderSummary(){if(!this.list.length)return;const e=this.list.reduce((m,l)=>m+l.FinalPrice*(l.quantity||1),0),s=e*y,t=10+(this.list.length-1)*2,i=e+s+t,o=document.querySelector(".subtotal"),a=document.querySelector(".tax"),c=document.querySelector(".shipping"),d=document.querySelector(".order-total");o&&(o.textContent=`$${e.toFixed(2)}`),a&&(a.textContent=`$${s.toFixed(2)}`),c&&(c.textContent=`$${t.toFixed(2)}`),d&&(d.textContent=`$${i.toFixed(2)}`),this.subtotal=e,this.tax=s,this.shipping=t,this.orderTotal=i}async checkout(e){const s=new FormData(e),t=Object.fromEntries(s.entries());if(f(t.expiration))return;if(!/^\d{3,4}$/.test(t.code)){n("Invalid security code. Must be 3 or 4 digits.");return}if(t.cardNumber!=="1234123412341234"){n("Invalid card number. Please use 1234123412341234.");return}if(t.code!=="123"){n("Invalid security code. Please use 123.");return}const i={orderDate:new Date().toISOString(),fname:t.fname,lname:t.lname,street:t.street,city:t.city,state:t.state,zip:t.zip,cardNumber:t.cardNumber,expiration:t.expiration,code:t.code,items:x(this.list),orderTotal:this.orderTotal.toFixed(2),shipping:this.shipping,tax:this.tax.toFixed(2)};try{const o=await this.services.checkout(i);console.log("Order submitted:",o),sessionStorage.setItem("recent-order",JSON.stringify(i)),localStorage.removeItem(this.key),e.reset(),window.location.href="./success.html"}catch(o){console.error("Checkout failed:",o),n("Checkout failed. Please check your inputs or try again later.")}}}const u=new g("so-cart",".order-summary");u.displayOrderSummary();document.getElementById("checkout-form").addEventListener("submit",r=>{r.preventDefault(),u.checkout(r.target)});
